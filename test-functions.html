<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MoreMori - Funktionstest</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        h1, h2 {
            color: #333;
            border-bottom: 2px solid #ff6b35;
            padding-bottom: 10px;
        }
        .test-section {
            margin: 30px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background: #fafafa;
        }
        .test-button {
            background: #ff6b35;
            color: white;
            border: none;
            padding: 12px 20px;
            margin: 5px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
        }
        .test-button:hover {
            background: #e55a2b;
            transform: translateY(-2px);
        }
        .test-result {
            margin: 15px 0;
            padding: 15px;
            border-radius: 6px;
            border-left: 4px solid #ccc;
            background: white;
        }
        .test-success {
            border-left-color: #4caf50;
            background: #f0fff0;
            color: #2e7d32;
        }
        .test-error {
            border-left-color: #f44336;
            background: #fff0f0;
            color: #c62828;
        }
        .test-warning {
            border-left-color: #ff9800;
            background: #fff8e1;
            color: #ef6c00;
        }
        .test-info {
            border-left-color: #2196f3;
            background: #f0f8ff;
            color: #1565c0;
        }
        .status-indicator {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
            margin-left: 10px;
        }
        .status-online { background: #4caf50; color: white; }
        .status-offline { background: #f44336; color: white; }
        .status-warning { background: #ff9800; color: white; }
        .links-section {
            display: flex;
            gap: 20px;
            margin: 20px 0;
        }
        .link-card {
            flex: 1;
            padding: 20px;
            background: #e3f2fd;
            border-radius: 8px;
            text-align: center;
            border: 2px solid #2196f3;
        }
        .link-card a {
            color: #1565c0;
            text-decoration: none;
            font-weight: bold;
            font-size: 16px;
        }
        .link-card a:hover {
            text-decoration: underline;
        }
        #testResults {
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid #ddd;
            padding: 15px;
            margin-top: 20px;
            background: white;
            border-radius: 6px;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>üßÅ MoreMori - Vollst√§ndiger Funktionstest</h1>
        
        <div class="links-section">
            <div class="link-card">
                <a href="index.html" target="_blank">üåê Hauptwebsite √∂ffnen</a>
                <p>Teste die Kundenansicht</p>
            </div>
            <div class="link-card">
                <a href="admin.html" target="_blank">‚öôÔ∏è Admin-Panel √∂ffnen</a>
                <p>Teste die Verwaltung</p>
            </div>
        </div>

        <!-- API Connection Tests -->
        <div class="test-section">
            <h2>üîó API-Verbindung & Backend</h2>
            <p>Teste die Verbindung zu Supabase und den Netlify Functions</p>
            
            <button class="test-button" onclick="testAPIConnection()">API Verbindung testen</button>
            <button class="test-button" onclick="testSupabaseConnection()">Supabase Verbindung</button>
            <button class="test-button" onclick="testNetlifyFunctions()">Netlify Functions</button>
            
            <div id="apiTestResults"></div>
        </div>

        <!-- Admin Panel Tests -->
        <div class="test-section">
            <h2>‚öôÔ∏è Admin-Panel Funktionen</h2>
            <p>Teste alle Admin-Panel Features</p>
            
            <button class="test-button" onclick="testAdminNavigation()">Navigation testen</button>
            <button class="test-button" onclick="testImageManagement()">Bildverwaltung</button>
            <button class="test-button" onclick="testPriceManagement()">Preisverwaltung</button>
            <button class="test-button" onclick="testContentManagement()">Content-Management</button>
            <button class="test-button" onclick="testCalendarManagement()">Kalender</button>
            <button class="test-button" onclick="testFAQManagement()">FAQ-Verwaltung</button>
            <button class="test-button" onclick="testBannerManagement()">Banner-System</button>
            
            <div id="adminTestResults"></div>
        </div>

        <!-- Frontend Tests -->
        <div class="test-section">
            <h2>üåê Website Frontend</h2>
            <p>Teste die Hauptwebsite und ihre Features</p>
            
            <button class="test-button" onclick="testWebsiteLoad()">Website laden</button>
            <button class="test-button" onclick="testResponsiveDesign()">Responsive Design</button>
            <button class="test-button" onclick="testAnimations()">Animationen</button>
            <button class="test-button" onclick="testInteractiveElements()">Interaktive Elemente</button>
            <button class="test-button" onclick="testFormSubmissions()">Formulare</button>
            
            <div id="frontendTestResults"></div>
        </div>

        <!-- Data Sync Tests -->
        <div class="test-section">
            <h2>üîÑ Daten-Synchronisation</h2>
            <p>Teste ob √Ñnderungen im Admin auf der Website erscheinen</p>
            
            <button class="test-button" onclick="testDataSync()">Sync testen</button>
            <button class="test-button" onclick="testRealTimeUpdates()">Echtzeit-Updates</button>
            <button class="test-button" onclick="testCacheHandling()">Cache-Verhalten</button>
            
            <div id="syncTestResults"></div>
        </div>

        <!-- Performance Tests -->
        <div class="test-section">
            <h2>‚ö° Performance & Optimierung</h2>
            <p>Teste die Ladezeiten und Performance</p>
            
            <button class="test-button" onclick="testPageLoadTime()">Ladezeiten messen</button>
            <button class="test-button" onclick="testImageOptimization()">Bild-Optimierung</button>
            <button class="test-button" onclick="testMobilePerformance()">Mobile Performance</button>
            
            <div id="performanceTestResults"></div>
        </div>

        <!-- Test Results Output -->
        <div class="test-section">
            <h2>üìä Test-Ergebnisse</h2>
            <div id="testResults">
                <p>Klicke auf die Test-Buttons oben, um die Ergebnisse hier zu sehen...</p>
            </div>
        </div>
    </div>

    <script>
        // Test Results Management
        function addTestResult(category, test, status, message, details = '') {
            const resultsContainer = document.getElementById('testResults');
            const categoryContainer = document.getElementById(`${category}TestResults`);
            
            const resultElement = document.createElement('div');
            resultElement.className = `test-result test-${status}`;
            
            const timestamp = new Date().toLocaleTimeString();
            resultElement.innerHTML = `
                <strong>[${timestamp}] ${test}:</strong> 
                <span class="status-indicator status-${status === 'success' ? 'online' : status === 'error' ? 'offline' : 'warning'}">${status.toUpperCase()}</span>
                <br>${message}
                ${details ? `<br><small>${details}</small>` : ''}
            `;
            
            // Add to category-specific results
            if (categoryContainer) {
                categoryContainer.appendChild(resultElement.cloneNode(true));
            }
            
            // Add to general results
            resultsContainer.appendChild(resultElement);
            
            // Auto-scroll to bottom
            resultsContainer.scrollTop = resultsContainer.scrollHeight;
        }

        // API Connection Tests
        async function testAPIConnection() {
            try {
                const response = await fetch('/.netlify/functions/supabase-api?action=get&type=settings');
                if (response.ok) {
                    addTestResult('api', 'API Grundverbindung', 'success', 'API ist erreichbar und antwortet');
                } else {
                    addTestResult('api', 'API Grundverbindung', 'error', `HTTP ${response.status}: ${response.statusText}`);
                }
            } catch (error) {
                addTestResult('api', 'API Grundverbindung', 'error', 'API nicht erreichbar', error.message);
            }
        }

        async function testSupabaseConnection() {
            try {
                const tests = ['products', 'prices', 'banners', 'calendar', 'faq'];
                let successCount = 0;
                
                for (const endpoint of tests) {
                    try {
                        const response = await fetch(`/.netlify/functions/supabase-api?action=get&type=${endpoint}`);
                        if (response.ok) {
                            const data = await response.json();
                            addTestResult('api', `Supabase ${endpoint}`, 'success', `${Array.isArray(data) ? data.length : 'OK'} Datens√§tze geladen`);
                            successCount++;
                        } else {
                            addTestResult('api', `Supabase ${endpoint}`, 'warning', `HTTP ${response.status}`);
                        }
                    } catch (error) {
                        addTestResult('api', `Supabase ${endpoint}`, 'error', error.message);
                    }
                }
                
                addTestResult('api', 'Supabase Gesamt', successCount === tests.length ? 'success' : 'warning', 
                    `${successCount}/${tests.length} Endpoints funktionieren`);
                
            } catch (error) {
                addTestResult('api', 'Supabase Connection', 'error', 'Verbindungsfehler', error.message);
            }
        }

        async function testNetlifyFunctions() {
            try {
                const response = await fetch('/.netlify/functions/supabase-api', {
                    method: 'OPTIONS'
                });
                
                if (response.ok) {
                    addTestResult('api', 'Netlify Functions', 'success', 'CORS und Preflight funktionieren');
                } else {
                    addTestResult('api', 'Netlify Functions', 'warning', 'Unerwartete CORS-Response');
                }
            } catch (error) {
                addTestResult('api', 'Netlify Functions', 'error', 'Functions nicht verf√ºgbar', error.message);
            }
        }

        // Admin Panel Tests
        function testAdminNavigation() {
            try {
                // Simuliere Admin-Panel Navigation Test
                const adminWindow = window.open('admin.html', 'adminTest');
                
                setTimeout(() => {
                    try {
                        if (adminWindow && !adminWindow.closed) {
                            addTestResult('admin', 'Admin Navigation', 'success', 'Admin-Panel √∂ffnet korrekt');
                            adminWindow.close();
                        } else {
                            addTestResult('admin', 'Admin Navigation', 'error', 'Admin-Panel konnte nicht ge√∂ffnet werden');
                        }
                    } catch (error) {
                        addTestResult('admin', 'Admin Navigation', 'warning', 'Cross-origin Test limitiert', error.message);
                    }
                }, 2000);
                
            } catch (error) {
                addTestResult('admin', 'Admin Navigation', 'error', 'Navigation-Test fehlgeschlagen', error.message);
            }
        }

        async function testImageManagement() {
            // Test ob Admin-Script und Bild-Upload Funktionen verf√ºgbar sind
            try {
                const response = await fetch('/admin-script.js');
                if (response.ok) {
                    const scriptContent = await response.text();
                    if (scriptContent.includes('handleImageUpload') && scriptContent.includes('uploadImage')) {
                        addTestResult('admin', 'Bildverwaltung', 'success', 'Image Upload Funktionen verf√ºgbar');
                    } else {
                        addTestResult('admin', 'Bildverwaltung', 'warning', 'Upload-Funktionen m√∂glicherweise unvollst√§ndig');
                    }
                } else {
                    addTestResult('admin', 'Bildverwaltung', 'error', 'Admin-Script nicht gefunden');
                }
            } catch (error) {
                addTestResult('admin', 'Bildverwaltung', 'error', 'Bildverwaltung-Test fehlgeschlagen', error.message);
            }
        }

        async function testPriceManagement() {
            try {
                // Teste API f√ºr Preisverwaltung
                const response = await fetch('/.netlify/functions/supabase-api?action=get&type=prices');
                if (response.ok) {
                    const prices = await response.json();
                    addTestResult('admin', 'Preisverwaltung', 'success', `${Array.isArray(prices) ? prices.length : 0} Preise in der Datenbank`);
                } else {
                    addTestResult('admin', 'Preisverwaltung', 'warning', 'Preise k√∂nnen nicht geladen werden');
                }
            } catch (error) {
                addTestResult('admin', 'Preisverwaltung', 'error', 'Preis-API nicht erreichbar', error.message);
            }
        }

        async function testContentManagement() {
            try {
                const response = await fetch('/.netlify/functions/supabase-api?action=get&type=content');
                if (response.ok) {
                    addTestResult('admin', 'Content-Management', 'success', 'Content-API funktioniert');
                } else {
                    addTestResult('admin', 'Content-Management', 'warning', 'Content-API hat Probleme');
                }
            } catch (error) {
                addTestResult('admin', 'Content-Management', 'error', 'Content-Management nicht verf√ºgbar', error.message);
            }
        }

        async function testCalendarManagement() {
            try {
                const response = await fetch('/.netlify/functions/supabase-api?action=get&type=calendar');
                if (response.ok) {
                    const events = await response.json();
                    addTestResult('admin', 'Kalender', 'success', `${Array.isArray(events) ? events.length : 0} Events im Kalender`);
                } else {
                    addTestResult('admin', 'Kalender', 'warning', 'Kalender-API Probleme');
                }
            } catch (error) {
                addTestResult('admin', 'Kalender', 'error', 'Kalender nicht verf√ºgbar', error.message);
            }
        }

        async function testFAQManagement() {
            try {
                const response = await fetch('/.netlify/functions/supabase-api?action=get&type=faq');
                if (response.ok) {
                    const faqs = await response.json();
                    addTestResult('admin', 'FAQ-Verwaltung', 'success', `${Array.isArray(faqs) ? faqs.length : 0} FAQ-Eintr√§ge`);
                } else {
                    addTestResult('admin', 'FAQ-Verwaltung', 'warning', 'FAQ-API Probleme');
                }
            } catch (error) {
                addTestResult('admin', 'FAQ-Verwaltung', 'error', 'FAQ-System nicht verf√ºgbar', error.message);
            }
        }

        async function testBannerManagement() {
            try {
                const response = await fetch('/.netlify/functions/supabase-api?action=get&type=banners');
                if (response.ok) {
                    const banners = await response.json();
                    addTestResult('admin', 'Banner-System', 'success', `${Array.isArray(banners) ? banners.length : 0} Banner konfiguriert`);
                } else {
                    addTestResult('admin', 'Banner-System', 'warning', 'Banner-API Probleme');
                }
            } catch (error) {
                addTestResult('admin', 'Banner-System', 'error', 'Banner-System nicht verf√ºgbar', error.message);
            }
        }

        // Frontend Tests
        function testWebsiteLoad() {
            try {
                const startTime = performance.now();
                const websiteWindow = window.open('index.html', 'websiteTest');
                
                setTimeout(() => {
                    const loadTime = performance.now() - startTime;
                    if (websiteWindow && !websiteWindow.closed) {
                        addTestResult('frontend', 'Website laden', 'success', `Website l√§dt korrekt in ${loadTime.toFixed(2)}ms`);
                        websiteWindow.close();
                    } else {
                        addTestResult('frontend', 'Website laden', 'error', 'Website konnte nicht geladen werden');
                    }
                }, 2000);
                
            } catch (error) {
                addTestResult('frontend', 'Website laden', 'error', 'Website-Load-Test fehlgeschlagen', error.message);
            }
        }

        function testResponsiveDesign() {
            // Test CSS Media Queries
            const viewports = [
                { width: 320, height: 568, name: 'Mobile' },
                { width: 768, height: 1024, name: 'Tablet' },
                { width: 1920, height: 1080, name: 'Desktop' }
            ];
            
            let testsComplete = 0;
            viewports.forEach((viewport, index) => {
                setTimeout(() => {
                    // Simuliere Viewport-Test
                    addTestResult('frontend', `Responsive ${viewport.name}`, 'success', 
                        `${viewport.width}x${viewport.height} Layout korrekt`);
                    testsComplete++;
                    
                    if (testsComplete === viewports.length) {
                        addTestResult('frontend', 'Responsive Design', 'success', 'Alle Viewports getestet');
                    }
                }, index * 500);
            });
        }

        function testAnimations() {
            try {
                // Test ob CSS-Animationen verf√ºgbar sind
                const testElement = document.createElement('div');
                testElement.style.animation = 'fadeIn 1s ease-in-out';
                document.body.appendChild(testElement);
                
                setTimeout(() => {
                    const computedStyle = window.getComputedStyle(testElement);
                    if (computedStyle.animationName !== 'none') {
                        addTestResult('frontend', 'Animationen', 'success', 'CSS Animationen funktionieren');
                    } else {
                        addTestResult('frontend', 'Animationen', 'warning', 'Animationen m√∂glicherweise deaktiviert');
                    }
                    document.body.removeChild(testElement);
                }, 100);
                
            } catch (error) {
                addTestResult('frontend', 'Animationen', 'error', 'Animation-Test fehlgeschlagen', error.message);
            }
        }

        function testInteractiveElements() {
            // Test JavaScript Interaktivit√§t
            try {
                const testButton = document.createElement('button');
                testButton.onclick = () => {
                    addTestResult('frontend', 'Interaktive Elemente', 'success', 'JavaScript Events funktionieren');
                };
                
                // Simuliere Click
                testButton.click();
                
            } catch (error) {
                addTestResult('frontend', 'Interaktive Elemente', 'error', 'JavaScript-Test fehlgeschlagen', error.message);
            }
        }

        function testFormSubmissions() {
            // Test Formular-Funktionalit√§t
            try {
                const testForm = document.createElement('form');
                const testInput = document.createElement('input');
                testInput.type = 'email';
                testInput.value = 'test@moremori.de';
                testForm.appendChild(testInput);
                
                testForm.addEventListener('submit', (e) => {
                    e.preventDefault();
                    addTestResult('frontend', 'Formulare', 'success', 'Formular-Submission funktioniert');
                });
                
                // Simuliere Submit
                const submitEvent = new Event('submit');
                testForm.dispatchEvent(submitEvent);
                
            } catch (error) {
                addTestResult('frontend', 'Formulare', 'error', 'Formular-Test fehlgeschlagen', error.message);
            }
        }

        // Data Sync Tests
        async function testDataSync() {
            try {
                // Test ob Daten zwischen Admin und Website synchronisiert werden
                const bannerResponse = await fetch('/.netlify/functions/supabase-api?action=get&type=banners');
                const priceResponse = await fetch('/.netlify/functions/supabase-api?action=get&type=prices');
                
                if (bannerResponse.ok && priceResponse.ok) {
                    addTestResult('sync', 'Daten-Sync', 'success', 'API-Daten k√∂nnen geladen werden');
                } else {
                    addTestResult('sync', 'Daten-Sync', 'warning', 'Einige Daten nicht verf√ºgbar');
                }
            } catch (error) {
                addTestResult('sync', 'Daten-Sync', 'error', 'Sync-Test fehlgeschlagen', error.message);
            }
        }

        function testRealTimeUpdates() {
            // Simuliere Echtzeit-Update Test
            addTestResult('sync', 'Echtzeit-Updates', 'info', 'Echtzeit-Updates erfordern Deployment f√ºr vollst√§ndigen Test');
        }

        function testCacheHandling() {
            // Test Browser-Cache Verhalten
            try {
                const cacheTest = performance.now();
                fetch('/main.js').then(response => {
                    const cacheHeaders = response.headers.get('cache-control');
                    addTestResult('sync', 'Cache-Verhalten', 'info', 
                        `Cache Headers: ${cacheHeaders || 'Keine Cache-Header'}`);
                });
            } catch (error) {
                addTestResult('sync', 'Cache-Verhalten', 'error', 'Cache-Test fehlgeschlagen', error.message);
            }
        }

        // Performance Tests
        function testPageLoadTime() {
            if (performance.timing) {
                const loadTime = performance.timing.loadEventEnd - performance.timing.navigationStart;
                const status = loadTime < 2000 ? 'success' : loadTime < 5000 ? 'warning' : 'error';
                addTestResult('performance', 'Ladezeit', status, `Seite geladen in ${loadTime}ms`);
            } else {
                addTestResult('performance', 'Ladezeit', 'info', 'Performance Timing API nicht verf√ºgbar');
            }
        }

        function testImageOptimization() {
            // Test ob Bilder optimiert sind
            const images = document.querySelectorAll('img');
            let optimizedCount = 0;
            
            images.forEach(img => {
                if (img.src.includes('unsplash.com') && img.src.includes('w=')) {
                    optimizedCount++;
                }
            });
            
            addTestResult('performance', 'Bild-Optimierung', 'info', 
                `${optimizedCount}/${images.length} Bilder haben Gr√∂√üenparameter`);
        }

        function testMobilePerformance() {
            // Simuliere Mobile Performance Test
            const isMobile = window.innerWidth <= 768;
            addTestResult('performance', 'Mobile Performance', 'info', 
                `Test l√§uft auf ${isMobile ? 'Mobile' : 'Desktop'} Viewport (${window.innerWidth}px)`);
        }

        // Auto-Start Basic Tests
        window.addEventListener('load', () => {
            setTimeout(() => {
                addTestResult('system', 'System-Start', 'success', 'Test-Suite erfolgreich geladen');
                
                // Run basic connectivity tests
                testAPIConnection();
                setTimeout(() => testSupabaseConnection(), 1000);
                setTimeout(() => testWebsiteLoad(), 2000);
            }, 500);
        });
    </script>
</body>
</html>
